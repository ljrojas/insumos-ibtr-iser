{
    "type": [
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        3,
        3,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        2,
        2,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        0,
        1,
        2,
        2,
        2,
        2,
        3,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        3,
        0,
        0,
        0,
        0,
        0,
        1,
        0,
        1,
        2
    ],
    "data": [
        "> ",
        "sel_comuna <- elementos[[2]]",
        "> ",
        "buscar <- elementos[[3]]",
        "> ",
        "sel_region$highlightElement()",
        "> ",
        "sel_comuna$highlightElement()",
        "> ",
        "buscar$highlightElement()",
        "> ",
        "resultado <-",
        "+ ",
        "  data.frame(",
        "+ ",
        "    region = as.character(),",
        "+ ",
        "    comuna = as.character(),",
        "+ ",
        "    mod_comuna = as.character(),",
        "+ ",
        "    direccion = as.character(),",
        "+ ",
        "    iframe_info = as.character(),",
        "+ ",
        "    latlot = as.character(),",
        "+ ",
        "    horario = as.character(),",
        "+ ",
        "    chileatiende = as.character()",
        "+ ",
        "  )",
        "> ",
        "pos <- 1",
        "> ",
        "# acumulador",
        "> ",
        "comunas_completadas <- c()",
        "> ",
        "# click selector region",
        "> ",
        "sel_region$clickElement()",
        "> ",
        "# rescatar opciones",
        "> ",
        "opt_region <- sel_region$findChildElements(\"tag\",\"option\")",
        "> ",
        "length(opt_region)",
        "[1] 17\n",
        "> ",
        "# i<- 7",
        "> ",
        "# iterar en cada region",
        "> ",
        "for (i in seq_len(length(opt_region))) {",
        "+ ",
        "  cat('i:',i,'\\n')",
        "+ ",
        "",
        "+ ",
        "  # click selector region",
        "+ ",
        "  sel_region$clickElement()",
        "+ ",
        "",
        "+ ",
        "  # rescata opciones",
        "+ ",
        "  text_opt_reg <-",
        "+ ",
        "    opt_region[[i]]$getElementText()[[1]] %>%",
        "+ ",
        "    stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "    str_to_lower() %>%",
        "+ ",
        "    str_trim()",
        "+ ",
        "",
        "+ ",
        "  # descartar texto \"seleccione\"",
        "+ ",
        "  if (str_detect(text_opt_reg,'seleccione')) {",
        "+ ",
        "    cat('Boton sin region\\n')",
        "+ ",
        "    next",
        "+ ",
        "  }",
        "+ ",
        "",
        "+ ",
        "  # click region",
        "+ ",
        "  cat('Click region:', text_opt_reg, '\\n')",
        "+ ",
        "  opt_region[[i]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "  # rescatar comunas",
        "+ ",
        "  sel_comuna$clickElement()",
        "+ ",
        "",
        "+ ",
        "  opt_comunas <- sel_comuna$findChildElements('tag','option')",
        "+ ",
        "",
        "+ ",
        "  # j<-2",
        "+ ",
        "",
        "+ ",
        "# comunas -----------------------------------------------------------------",
        "+ ",
        "  num_comunas <- length(opt_comunas)",
        "+ ",
        "  for (j in seq_len(length(opt_comunas))) {",
        "+ ",
        "  cat('j:',j,'\\n')",
        "+ ",
        "  cat('num comunas:',num_comunas,'\\n')",
        "+ ",
        "    # elementos <- rescatar_elementos()",
        "+ ",
        "    # sel_region <- elementos[[1]]",
        "+ ",
        "    # sel_comuna <- elementos[[2]]",
        "+ ",
        "    # buscar <- elementos[[3]]",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    text_comuna <-",
        "+ ",
        "      opt_comunas[[j]]$getElementText()[[1]] %>%",
        "+ ",
        "      stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "      str_to_lower() %>%",
        "+ ",
        "      str_trim()",
        "+ ",
        "",
        "+ ",
        "    # saltarse texto instruccion",
        "+ ",
        "    if (str_detect(text_comuna,'seleccionar comuna')) next",
        "+ ",
        "",
        "+ ",
        "    # nombre y modificador comuna",
        "+ ",
        "    mod_comuna <-",
        "+ ",
        "      str_extract(text_comuna,'(?<=- ).+')",
        "+ ",
        "    if (is.na(mod_comuna)) mod_comuna <- 'sin modificador'",
        "+ ",
        "    nom_comuna <- text_comuna",
        "+ ",
        "    if (str_detect(text_comuna,' - ')) nom_comuna <- str_extract(text_comuna, '.+(?= -)')",
        "+ ",
        "",
        "+ ",
        "    # salterse comuna completa",
        "+ ",
        "    if (nom_comuna %in% comunas_completadas) next",
        "+ ",
        "",
        "+ ",
        "    # programa avisa en que comuna va",
        "+ ",
        "    cat(text_comuna,'\\n')",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    # busqueda ----------------------------------------------------------------",
        "+ ",
        "",
        "+ ",
        "    # click comuna",
        "+ ",
        "    opt_comunas[[j]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "    # click buscar",
        "+ ",
        "    cat('click buscar\\n')",
        "+ ",
        "    buscar$clickElement()",
        "+ ",
        "",
        "+ ",
        "    # panel donde esta la informacion",
        "+ ",
        "",
        "+ ",
        "    panel <- remDr$findElements(\"xpath\",\"//div[contains(@class,'panel-body')]\")",
        "+ ",
        "    length(panel) # en general son 16 (16 regiones)",
        "+ ",
        "",
        "+ ",
        "    p <- i - 1",
        "+ ",
        "    # al filtrar por selectores deberia el primero ser operativo",
        "+ ",
        "    panel[[p]]$highlightElement()",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    # direccion",
        "+ ",
        "    info_gral <- panel[[p]]$findChildElements(\"class\",\"minirecuadro\")",
        "+ ",
        "    length(info_gral)",
        "+ ",
        "",
        "+ ",
        "    # info varia",
        "+ ",
        "    for (x in seq_len(length(info_gral))) {",
        "+ ",
        "      text_info_gral <- info_gral[[x]]$getElementText()[[1]] %>% str_trim()",
        "+ ",
        "      if (text_info_gral==\"\") next",
        "+ ",
        "      text_info <- limpiar_texto(text_info_gral)",
        "+ ",
        "      cat(text_info,\"\\n\")",
        "+ ",
        "      # checkear:",
        "+ ",
        "      # - direccion",
        "+ ",
        "      if (str_detect(text_info,'direccion')) direccion <- text_info",
        "+ ",
        "      # - horario",
        "+ ",
        "      if (str_detect(text_info,'horario')) horario <- text_info",
        "+ ",
        "      # - chileatiende",
        "+ ",
        "      if (str_detect(text_info,'chileatiende')) chileatiende <- text_info",
        "+ ",
        "      # TODO: if check guarda info",
        "+ ",
        "    }",
        "+ ",
        "",
        "+ ",
        "    # boton mapa",
        "+ ",
        "    btn_gm <- panel[[p]]$findChildElements(\"class\",\"alternar-respuesta\")",
        "+ ",
        "    length(btn_gm)",
        "+ ",
        "",
        "+ ",
        "    b<-1",
        "+ ",
        "    # para cada candidato a boton de mapa",
        "+ ",
        "    for (b in seq_len(length(btn_gm))) {",
        "+ ",
        "      # btn_gm[[1]]$highlightElement()",
        "+ ",
        "",
        "+ ",
        "      # rescatar texto",
        "+ ",
        "      text_btn <- btn_gm[[b]]$getElementText()[[1]] %>% str_trim()",
        "+ ",
        "      # saltar texto vacio",
        "+ ",
        "      if (text_btn==\"\") next",
        "+ ",
        "      # mostrar texto boton",
        "+ ",
        "      cat(text_btn,\"\\n\")",
        "+ ",
        "",
        "+ ",
        "      # buscar info preliminar iframe",
        "+ ",
        "      data_iframe <- btn_gm[[b]]$getElementAttribute(\"data-iframe\")",
        "+ ",
        "      length(data_iframe)",
        "+ ",
        "      # data_iframe %>% str_extract(\"(?<=!2d)-+\\\\d+\\\\.+\\\\d+\")",
        "+ ",
        "",
        "+ ",
        "      # click boton iframe (abre mapa)",
        "+ ",
        "      btn_gm[[b]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "      # seleccionar iframe",
        "+ ",
        "",
        "+ ",
        "      iframe <- panel[[p]]$findChildElements(\"tag\",\"iframe\")[[1]]",
        "+ ",
        "",
        "+ ",
        "      remDr$switchToFrame(iframe)",
        "+ ",
        "      Sys.sleep(2)",
        "+ ",
        "",
        "+ ",
        "      # alternativa: text \"Ampliar el Mapa\"",
        "+ ",
        "      ll <- remDr$findElements(\"xpath\",\"//*[contains(@href,'?ll=')]\")",
        "+ ",
        "      href <- ll[[1]]$getElementAttribute('href')",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "      if (text_btn == \"Ver mapa\") break",
        "+ ",
        "",
        "+ ",
        "      cat('fin ciclo boton')",
        "+ ",
        "    } # fin ciclo boton",
        "+ ",
        "",
        "+ ",
        "    # guardar info -----",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    resultado[pos,] <-",
        "+ ",
        "      c(",
        "+ ",
        "        text_opt_reg,",
        "+ ",
        "        nom_comuna,",
        "+ ",
        "        mod_comuna,",
        "+ ",
        "        direccion,",
        "+ ",
        "        data_iframe,",
        "+ ",
        "        href,",
        "+ ",
        "        horario,",
        "+ ",
        "        chileatiende",
        "+ ",
        "      )",
        "+ ",
        "",
        "+ ",
        "    # actualizar comunas completas y pos ------",
        "+ ",
        "    pos <- pos + 1",
        "+ ",
        "",
        "+ ",
        "    comunas_completadas <- c(comunas_completadas, nom_comuna)",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    # volver a frame original",
        "+ ",
        "    # remDr$switchToFrame(NULL)",
        "+ ",
        "    # OPCIONES",
        "+ ",
        "",
        "+ ",
        "    # checkear elementos usados no esten en acumulador",
        "+ ",
        "    # reinciar (actualizar)",
        "+ ",
        "",
        "+ ",
        "    cat('recarga pagina\\n')",
        "+ ",
        "    remDr$navigate(url_isp)",
        "+ ",
        "    Sys.sleep(1)",
        "+ ",
        "",
        "+ ",
        "    elementos <- rescatar_elementos()",
        "+ ",
        "    sel_region <- elementos[[1]]",
        "+ ",
        "    sel_comuna <- elementos[[2]]",
        "+ ",
        "    buscar <- elementos[[3]]",
        "+ ",
        "",
        "+ ",
        "    opt_region <- sel_region$findChildElements(\"tag\",\"option\")",
        "+ ",
        "",
        "+ ",
        "    # click region",
        "+ ",
        "    # cat('Click region:', text_opt_reg, '\\n')",
        "+ ",
        "    opt_region[[i]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "    text_opt_reg <-",
        "+ ",
        "      opt_region[[i]]$getElementText()[[1]] %>%",
        "+ ",
        "      stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "      str_to_lower() %>%",
        "+ ",
        "      str_trim()",
        "+ ",
        "",
        "+ ",
        "    if (j == num_comunas) cat('fin ciclo comuna\\n-----------\\n'); next",
        "+ ",
        "",
        "+ ",
        "    # rescatar comunas",
        "+ ",
        "    sel_comuna$clickElement()",
        "+ ",
        "",
        "+ ",
        "    opt_comunas <- sel_comuna$findChildElements('tag','option')",
        "+ ",
        "",
        "+ ",
        "    cat('fin ciclo comuna\\n-----------\\n')",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "  } # fin ciclo comuna",
        "+ ",
        "",
        "+ ",
        "cat('fin ciclo region\\n************\\n')",
        "+ ",
        "}",
        "i: 1 \nBoton sin region\ni: 2 \nClick region: region de arica y parinacota \nj: 1 \nnum comunas: 3 \nj: 2 \nnum comunas: 3 \narica \nclick buscar\ndireccion: juan noe n° 933 \nhorario de atencion: lunes a jueves, de 08:30 a 14:30 hrs. viernes, 08:30 a 14:00 hrs. \nmodulo chileatiende express. tramites que se pueden realizar \nvideointerpretacion ¿que es? \nreserve su hora de atencion aqui. ¿tramites ips que se pueden agendar? \nVer mapa \nrecarga pagina\nj: 3 \nnum comunas: 3 \n",
        "\nSelenium message:stale element reference: element is not attached to the page document\n  (Session info: chrome=89.0.4389.82)\nFor documentation on this error, please visit: https://www.seleniumhq.org/exceptions/stale_element_reference.html\nBuild info: version: '4.0.0-alpha-2', revision: 'f148142cf8', time: '2019-07-01T21:30:10'\nSystem info: host: 'LAPTOP-NG35NH82', ip: '10.20.1.57', os.name: 'Windows 10', os.arch: 'amd64', os.version: '10.0', java.version: '1.8.0_251'\nDriver info: driver.version: unknown\n\n",
        "Error: \t Summary: StaleElementReference\n \t Detail: An element command failed because the referenced element is no longer attached to the DOM.\n \t class: org.openqa.selenium.StaleElementReferenceException\n\t Further Details: run errorDetails method\n",
        "> ",
        "    text_opt_reg <-",
        "+ ",
        "      opt_region[[i]]$getElementText()[[1]] %>%",
        "+ ",
        "      stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "      str_to_lower() %>%",
        "+ ",
        "      str_trim()",
        "> ",
        "text_opt_reg",
        "[1] \"region de arica y parinacota\"\n",
        "> ",
        "opt_comunas",
        "[[1]]\n[1] \"remoteDriver fields\"\n$remoteServerAddr\n[1] \"localhost\"\n\n$port\n[1] 4567\n\n$browserName\n[1] \"chrome\"\n\n$version\n[1] \"\"\n\n$platform\n[1] \"ANY\"\n\n$javascript\n[1] TRUE\n\n$nativeEvents\n[1] TRUE\n\n$extraCapabilities\nlist()\n\n[1] \"webElement fields\"\n$elementId\n[1] \"c1548fcc-5aa2-4340-8eca-8256d92726da\"\n\n\n[[2]]\n[1] \"remoteDriver fields\"\n$remoteServerAddr\n[1] \"localhost\"\n\n$port\n[1] 4567\n\n$browserName\n[1] \"chrome\"\n\n$version\n[1] \"\"\n\n$platform\n[1] \"ANY\"\n\n$javascript\n[1] TRUE\n\n$nativeEvents\n[1] TRUE\n\n$extraCapabilities\n",
        "list()\n\n[1] \"webElement fields\"\n$elementId\n[1] \"2b409fda-01e7-49ea-a267-2e3e3e549d4e\"\n\n\n[[3]]\n[1] \"remoteDriver fields\"\n$remoteServerAddr\n[1] \"localhost\"\n\n$port\n[1] 4567\n\n$browserName\n[1] \"chrome\"\n\n$version\n[1] \"\"\n\n$platform\n[1] \"ANY\"\n\n$javascript\n[1] TRUE\n\n$nativeEvents\n[1] TRUE\n\n$extraCapabilities\nlist()\n\n[1] \"webElement fields\"\n$elementId\n[1] \"5ad65528-1718-4914-8178-e04ba09c315b\"\n\n\n",
        "> ",
        "length(opt_comunas)",
        "[1] 3\n",
        "> ",
        "# visistar url busqueda",
        "> ",
        "remDr$navigate(url_isp)",
        "> ",
        "elementos <- rescatar_elementos()",
        "> ",
        "sel_region <- elementos[[1]]",
        "> ",
        "sel_comuna <- elementos[[2]]",
        "> ",
        "buscar <- elementos[[3]]",
        "> ",
        "sel_region$highlightElement()",
        "> ",
        "sel_comuna$highlightElement()",
        "> ",
        "buscar$highlightElement()",
        "> ",
        "pos <- 1",
        "> ",
        "# click selector region\nsel_region$clickElement()",
        "> ",
        "length(opt_region)",
        "[1] 17\n",
        "> ",
        "resultado <-",
        "+ ",
        "  data.frame(",
        "+ ",
        "    region = as.character(),",
        "+ ",
        "    comuna = as.character(),",
        "+ ",
        "    mod_comuna = as.character(),",
        "+ ",
        "    direccion = as.character(),",
        "+ ",
        "    iframe_info = as.character(),",
        "+ ",
        "    latlot = as.character(),",
        "+ ",
        "    horario = as.character(),",
        "+ ",
        "    chileatiende = as.character()",
        "+ ",
        "  )",
        "> ",
        "# acumulador",
        "> ",
        "comunas_completadas <- c()",
        "> ",
        "# rescatar opciones",
        "> ",
        "opt_region <- sel_region$findChildElements(\"tag\",\"option\")",
        "> ",
        "# i<- 7",
        "> ",
        "# iterar en cada region",
        "> ",
        "for (i in seq_len(length(opt_region))) {",
        "+ ",
        "  cat('i:',i,'\\n')",
        "+ ",
        "",
        "+ ",
        "  # click selector region",
        "+ ",
        "  sel_region$clickElement()",
        "+ ",
        "",
        "+ ",
        "  # rescata opciones",
        "+ ",
        "  text_opt_reg <-",
        "+ ",
        "    opt_region[[i]]$getElementText()[[1]] %>%",
        "+ ",
        "    stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "    str_to_lower() %>%",
        "+ ",
        "    str_trim()",
        "+ ",
        "",
        "+ ",
        "  # descartar texto \"seleccione\"",
        "+ ",
        "  if (str_detect(text_opt_reg,'seleccione')) {",
        "+ ",
        "    cat('Boton sin region\\n')",
        "+ ",
        "    next",
        "+ ",
        "  }",
        "+ ",
        "",
        "+ ",
        "  # click region",
        "+ ",
        "  cat('Click region:', text_opt_reg, '\\n')",
        "+ ",
        "  opt_region[[i]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "  # rescatar comunas",
        "+ ",
        "  sel_comuna$clickElement()",
        "+ ",
        "",
        "+ ",
        "  opt_comunas <- sel_comuna$findChildElements('tag','option')",
        "+ ",
        "",
        "+ ",
        "  # j<-2",
        "+ ",
        "",
        "+ ",
        "# comunas -----------------------------------------------------------------",
        "+ ",
        "  num_comunas <- length(opt_comunas)",
        "+ ",
        "  for (j in seq_len(length(opt_comunas))) {",
        "+ ",
        "  cat('j:',j,'\\n')",
        "+ ",
        "  cat('num comunas:',num_comunas,'\\n')",
        "+ ",
        "    # elementos <- rescatar_elementos()",
        "+ ",
        "    # sel_region <- elementos[[1]]",
        "+ ",
        "    # sel_comuna <- elementos[[2]]",
        "+ ",
        "    # buscar <- elementos[[3]]",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    text_comuna <-",
        "+ ",
        "      opt_comunas[[j]]$getElementText()[[1]] %>%",
        "+ ",
        "      stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "      str_to_lower() %>%",
        "+ ",
        "      str_trim()",
        "+ ",
        "",
        "+ ",
        "    # saltarse texto instruccion",
        "+ ",
        "    if (str_detect(text_comuna,'seleccionar comuna')) next",
        "+ ",
        "",
        "+ ",
        "    # nombre y modificador comuna",
        "+ ",
        "    mod_comuna <-",
        "+ ",
        "      str_extract(text_comuna,'(?<=- ).+')",
        "+ ",
        "    if (is.na(mod_comuna)) mod_comuna <- 'sin modificador'",
        "+ ",
        "    nom_comuna <- text_comuna",
        "+ ",
        "    if (str_detect(text_comuna,' - ')) nom_comuna <- str_extract(text_comuna, '.+(?= -)')",
        "+ ",
        "",
        "+ ",
        "    # salterse comuna completa",
        "+ ",
        "    if (nom_comuna %in% comunas_completadas) next",
        "+ ",
        "",
        "+ ",
        "    # programa avisa en que comuna va",
        "+ ",
        "    cat(text_comuna,'\\n')",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    # busqueda ----------------------------------------------------------------",
        "+ ",
        "",
        "+ ",
        "    # click comuna",
        "+ ",
        "    opt_comunas[[j]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "    # click buscar",
        "+ ",
        "    cat('click buscar\\n')",
        "+ ",
        "    buscar$clickElement()",
        "+ ",
        "",
        "+ ",
        "    # panel donde esta la informacion",
        "+ ",
        "",
        "+ ",
        "    panel <- remDr$findElements(\"xpath\",\"//div[contains(@class,'panel-body')]\")",
        "+ ",
        "    length(panel) # en general son 16 (16 regiones)",
        "+ ",
        "",
        "+ ",
        "    p <- i - 1",
        "+ ",
        "    # al filtrar por selectores deberia el primero ser operativo",
        "+ ",
        "    panel[[p]]$highlightElement()",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    # direccion",
        "+ ",
        "    info_gral <- panel[[p]]$findChildElements(\"class\",\"minirecuadro\")",
        "+ ",
        "    length(info_gral)",
        "+ ",
        "",
        "+ ",
        "    # info varia",
        "+ ",
        "    for (x in seq_len(length(info_gral))) {",
        "+ ",
        "      text_info_gral <- info_gral[[x]]$getElementText()[[1]] %>% str_trim()",
        "+ ",
        "      if (text_info_gral==\"\") next",
        "+ ",
        "      text_info <- limpiar_texto(text_info_gral)",
        "+ ",
        "      cat(text_info,\"\\n\")",
        "+ ",
        "      # checkear:",
        "+ ",
        "      # - direccion",
        "+ ",
        "      if (str_detect(text_info,'direccion')) direccion <- text_info",
        "+ ",
        "      # - horario",
        "+ ",
        "      if (str_detect(text_info,'horario')) horario <- text_info",
        "+ ",
        "      # - chileatiende",
        "+ ",
        "      if (str_detect(text_info,'chileatiende')) chileatiende <- text_info",
        "+ ",
        "      # TODO: if check guarda info",
        "+ ",
        "    }",
        "+ ",
        "",
        "+ ",
        "    # boton mapa",
        "+ ",
        "    btn_gm <- panel[[p]]$findChildElements(\"class\",\"alternar-respuesta\")",
        "+ ",
        "    length(btn_gm)",
        "+ ",
        "",
        "+ ",
        "    b<-1",
        "+ ",
        "    # para cada candidato a boton de mapa",
        "+ ",
        "    for (b in seq_len(length(btn_gm))) {",
        "+ ",
        "      # btn_gm[[1]]$highlightElement()",
        "+ ",
        "",
        "+ ",
        "      # rescatar texto",
        "+ ",
        "      text_btn <- btn_gm[[b]]$getElementText()[[1]] %>% str_trim()",
        "+ ",
        "      # saltar texto vacio",
        "+ ",
        "      if (text_btn==\"\") next",
        "+ ",
        "      # mostrar texto boton",
        "+ ",
        "      cat(text_btn,\"\\n\")",
        "+ ",
        "",
        "+ ",
        "      # buscar info preliminar iframe",
        "+ ",
        "      data_iframe <- btn_gm[[b]]$getElementAttribute(\"data-iframe\")",
        "+ ",
        "      length(data_iframe)",
        "+ ",
        "      # data_iframe %>% str_extract(\"(?<=!2d)-+\\\\d+\\\\.+\\\\d+\")",
        "+ ",
        "",
        "+ ",
        "      # click boton iframe (abre mapa)",
        "+ ",
        "      btn_gm[[b]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "      # seleccionar iframe",
        "+ ",
        "",
        "+ ",
        "      iframe <- panel[[p]]$findChildElements(\"tag\",\"iframe\")[[1]]",
        "+ ",
        "",
        "+ ",
        "      remDr$switchToFrame(iframe)",
        "+ ",
        "      Sys.sleep(2)",
        "+ ",
        "",
        "+ ",
        "      # alternativa: text \"Ampliar el Mapa\"",
        "+ ",
        "      ll <- remDr$findElements(\"xpath\",\"//*[contains(@href,'?ll=')]\")",
        "+ ",
        "      href <- ll[[1]]$getElementAttribute('href')",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "      if (text_btn == \"Ver mapa\") break",
        "+ ",
        "",
        "+ ",
        "      cat('fin ciclo boton')",
        "+ ",
        "    } # fin ciclo boton",
        "+ ",
        "",
        "+ ",
        "    # guardar info -----",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    resultado[pos,] <-",
        "+ ",
        "      c(",
        "+ ",
        "        text_opt_reg,",
        "+ ",
        "        nom_comuna,",
        "+ ",
        "        mod_comuna,",
        "+ ",
        "        direccion,",
        "+ ",
        "        data_iframe,",
        "+ ",
        "        href,",
        "+ ",
        "        horario,",
        "+ ",
        "        chileatiende",
        "+ ",
        "      )",
        "+ ",
        "",
        "+ ",
        "    # actualizar comunas completas y pos ------",
        "+ ",
        "    pos <- pos + 1",
        "+ ",
        "",
        "+ ",
        "    comunas_completadas <- c(comunas_completadas, nom_comuna)",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "    # volver a frame original",
        "+ ",
        "    # remDr$switchToFrame(NULL)",
        "+ ",
        "    # OPCIONES",
        "+ ",
        "",
        "+ ",
        "    # checkear elementos usados no esten en acumulador",
        "+ ",
        "    # reinciar (actualizar)",
        "+ ",
        "",
        "+ ",
        "    cat('recarga pagina\\n')",
        "+ ",
        "    remDr$navigate(url_isp)",
        "+ ",
        "    Sys.sleep(1)",
        "+ ",
        "",
        "+ ",
        "    elementos <- rescatar_elementos()",
        "+ ",
        "    sel_region <- elementos[[1]]",
        "+ ",
        "    sel_comuna <- elementos[[2]]",
        "+ ",
        "    buscar <- elementos[[3]]",
        "+ ",
        "",
        "+ ",
        "    opt_region <- sel_region$findChildElements(\"tag\",\"option\")",
        "+ ",
        "",
        "+ ",
        "    # click region",
        "+ ",
        "    # cat('Click region:', text_opt_reg, '\\n')",
        "+ ",
        "    opt_region[[i]]$clickElement()",
        "+ ",
        "",
        "+ ",
        "    text_opt_reg <-",
        "+ ",
        "      opt_region[[i]]$getElementText()[[1]] %>%",
        "+ ",
        "      stri_trans_general(\"Latin-ASCII\") %>%",
        "+ ",
        "      str_to_lower() %>%",
        "+ ",
        "      str_trim()",
        "+ ",
        "",
        "+ ",
        "    if (j == num_comunas) next",
        "+ ",
        "",
        "+ ",
        "    # rescatar comunas",
        "+ ",
        "    sel_comuna$clickElement()",
        "+ ",
        "",
        "+ ",
        "    opt_comunas <- sel_comuna$findChildElements('tag','option')",
        "+ ",
        "",
        "+ ",
        "    cat('fin ciclo comuna\\n-----------\\n')",
        "+ ",
        "",
        "+ ",
        "",
        "+ ",
        "  } # fin ciclo comuna",
        "+ ",
        "",
        "+ ",
        "cat('fin ciclo region\\n************\\n')",
        "+ ",
        "}",
        "i: 1 \nBoton sin region\ni: 2 \nClick region: region de arica y parinacota \nj: 1 \nnum comunas: 3 \nj: 2 \nnum comunas: 3 \narica \nclick buscar\ndireccion: juan noe n° 933 \nhorario de atencion: lunes a jueves, de 08:30 a 14:30 hrs. viernes, 08:30 a 14:00 hrs. \nmodulo chileatiende express. tramites que se pueden realizar \nvideointerpretacion ¿que es? \nreserve su hora de atencion aqui. ¿tramites ips que se pueden agendar? \nVer mapa \nrecarga pagina\nfin ciclo comuna\n-----------\nj: 3 \nnum comunas: 3 \nputre \nclick buscar\n",
        "direccion: jose miguel carrera n° 350 \nhorario de atencion: lunes a jueves, de 08:30 a 14:30 hrs. viernes, 08:30 a 14:00 hrs. \nVer mapa \nrecarga pagina\nfin ciclo region\n************\ni: 3 \nClick region: region de tarapaca \nj: 1 \nnum comunas: 4 \nj: 2 \nnum comunas: 4 \nalto hospicio \nclick buscar\ndireccion: avenida la pampa n° 3117, locales 17 y 18. \nhorario de atencion: lunes a viernes, 08:30 a 14:00 hrs. \nmodulo chileatiende express. tramites que se pueden realizar \nvideointerpretacion ¿que es? \nVer mapa \n",
        "recarga pagina\nfin ciclo comuna\n-----------\nj: 3 \nnum comunas: 4 \niquique \nclick buscar\ndireccion: tarapaca n° 568 \nhorario de atencion: lunes a viernes, 08:30 a 14:00 hrs. \nmodulo chileatiende express. tramites que se pueden realizar \nvideointerpretacion ¿que es? \nVer mapa \nrecarga pagina\nfin ciclo comuna\n-----------\nj: 4 \nnum comunas: 4 \npozo almonte \nclick buscar\ndireccion: aldunate n° 310 \nhorario de atencion: lunes, martes, jueves y viernes, de 08:30 a 14:00 hrs. \nVer mapa \nrecarga pagina\nfin ciclo region\n************\n",
        "i: 4 \nClick region: region de antofagasta \nj: 1 \nnum comunas: 6 \nj: 2 \nnum comunas: 6 \nantofagasta \nclick buscar\ndireccion: sucre n° 311, 2º piso \nhorario de atencion: lunes a jueves, de 08:30 a 14:30 hrs. viernes, 08:30 a 14:00 hrs. \nmodulo chileatiende express. tramites que se pueden realizar \nvideointerpretacion ¿que es? \nreserve su hora de atencion aqui. ¿tramites ips que se pueden agendar? \nVer mapa \nrecarga pagina\n",
        "Error in checkError(res) : \n  Undefined error in httr call. httr output: Operation was aborted by an application callback\n",
        "> ",
        "> ",
        "> ",
        "> ",
        "    elementos <- rescatar_elementos()",
        "> ",
        "source('~/projects/insumos-ibtr-iser/isp-scrapping.R', encoding = 'UTF-8')",
        "checking Selenium Server versions:\n",
        "BEGIN: PREDOWNLOAD\n",
        "BEGIN: DOWNLOAD\n",
        "BEGIN: POSTDOWNLOAD\n",
        "checking chromedriver versions:\n",
        "BEGIN: PREDOWNLOAD\n",
        "BEGIN: DOWNLOAD\n",
        "BEGIN: POSTDOWNLOAD\n",
        "checking geckodriver versions:\n",
        "BEGIN: PREDOWNLOAD\n",
        "BEGIN: DOWNLOAD\n",
        "BEGIN: POSTDOWNLOAD\n",
        "checking phantomjs versions:\n",
        "BEGIN: PREDOWNLOAD\n",
        "BEGIN: DOWNLOAD\n",
        "BEGIN: POSTDOWNLOAD\n",
        "> ",
        "> ",
        "> ",
        "> ",
        "> ",
        "# cerrar selenium",
        "> ",
        "remDr$close()",
        "\nRestarting R session...\n\n"
    ]
}